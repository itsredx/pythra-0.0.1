<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TextField Focus Test</title>
    <!-- ADD SIMPLEBAR CSS -->
    <link rel="stylesheet" href="./js/scroll-bar/simplebar.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link id="base-stylesheet" type="text/css" rel="stylesheet" href="styles.css?v=1754101266">
    <style id="dynamic-styles">.shared-container-0 { box-sizing: border-box; padding: 32px; display: flex; justify-content: center; align-items: flex-start; }
.shared-column-0 { display: flex; flex-direction: column; justify-content: flex-start; align-items: stretch; height: 100%; direction: ltr; }

            .shared-text-0 {
                margin: 0; /* Reset default paragraph margin */
                padding: 0;
                font-size: 24px; font-weight: bold;
                
                
            }
            

        /* === Styles for shared-textfield-0 === */


        .textfield-root-container.shared-textfield-0 {
            display: flex; flex-direction: column; margin: 0px;
            border-radius: 4px;
            width: 100%;
        }
        .textfield-root-container.shared-textfield-0 .textfield-container {
            position: relative; padding-top: 0px;
        }
        .textfield-root-container.shared-textfield-0 .textfield-input {
            width: 100%; height: 34px; padding: 0px 8px; font-size: 14px;
            color: #D9D9D9; background-color: None;
            border-top: none;
            border-left: none;
            border-right: none;
            border-bottom:1.0px solid #79747E; outline: none; border-radius: 4px; box-sizing: border-box;
            transition: background-color 0.2s;
        }
        .textfield-root-container.shared-textfield-0 .textfield-label {
            position: absolute; left: 16px; top: 16px; font-size: 16px;
            color: #49454F; pointer-events: none;
            transform-origin: left top; transform: translateY(-50%);
            transition: transform 0.2s, color 0.2s;
        }
        .textfield-root-container.shared-textfield-0 .textfield-outline {
            position: absolute; bottom: 0; left: 0; right: 0;
            height: 1.0px; background-color: #79747E;
            transition: background-color 0.2s, height 0.2s; display: none;
        }
        .textfield-root-container.shared-textfield-0  .textfield-helper-text {
            padding: 4px 16px 0 16px; font-size: 12px; color: #49454F;
            min-height: 1.2em; transition: color 0.2s;
        }
        .textfield-root-container.shared-textfield-0 .textfield-helper-text:empty {
             display: none; 
        }

        /* --- FOCUSED STATE (Scoped) --- */
        .textfield-root-container.shared-textfield-0 .textfield-input:focus {
            border-top: none;
            border-left: none;
            border-right: none;
            border-bottom:1.0px solid #FF94DA;
        }
        .textfield-root-container.shared-textfield-0 .textfield-input:focus ~ .textfield-label {
            transform: translateY(-190%) scale(0.75);
            color: #6750A4;
            display: none;
        }
        .textfield-root-container.shared-textfield-0:focus-within .textfield-outline {
            height: 2.0px;
            background-color: #6750A4;
        }
        
        /* --- ERROR STATE (Scoped) --- */
        .textfield-root-container.shared-textfield-0.error .textfield-label,
        .textfield-root-container.shared-textfield-0.error:focus-within .textfield-label {
            color: #B3261E;
        }
        .textfield-root-container.shared-textfield-0.error .textfield-outline {
            height: 2.0px;
            background-color: #B3261E;
        }
        .textfield-root-container.shared-textfield-0.error .textfield-helper-text {
            color: #B3261E;
        }

        /* --- DISABLED STATE (Scoped) --- */
        .textfield-root-container.shared-textfield-0.disabled .textfield-input {
            background-color: rgba(0, 0, 0, 0.06);
            color: rgba(0, 0, 0, 0.38);
        }
        .textfield-root-container.shared-textfield-0.disabled .textfield-label,
        .textfield-root-container.shared-textfield-0.disabled .textfield-helper-text {
            color: rgba(0, 0, 0, 0.38);
        }
        .textfield-root-container.shared-textfield-0.disabled .textfield-outline {
            background-color: rgba(0, 0, 0, 0.12);
        }
        

        /* === Styles for shared-textfield-1 === */


        .textfield-root-container.shared-textfield-1 {
            display: flex; flex-direction: column; margin: 0px;
            border-radius: 4px;
            width: 100%;
        }
        .textfield-root-container.shared-textfield-1 .textfield-container {
            position: relative; padding-top: 0px;
        }
        .textfield-root-container.shared-textfield-1 .textfield-input {
            width: 100%; height: 34px; padding: 0px 8px; font-size: 14px;
            color: #D9D9D9; background-color: transparent;
            border-top: none;
            border-left: none;
            border-right: none;
            border-bottom:1px solid grey; outline: none; border-radius: 4px; box-sizing: border-box;
            transition: background-color 0.2s;
        }
        .textfield-root-container.shared-textfield-1 .textfield-label {
            position: absolute; left: 16px; top: 16px; font-size: 16px;
            color: #49454F; pointer-events: none;
            transform-origin: left top; transform: translateY(-50%);
            transition: transform 0.2s, color 0.2s;
        }
        .textfield-root-container.shared-textfield-1 .textfield-outline {
            position: absolute; bottom: 0; left: 0; right: 0;
            height: 1px; background-color: grey;
            transition: background-color 0.2s, height 0.2s; display: none;
        }
        .textfield-root-container.shared-textfield-1  .textfield-helper-text {
            padding: 4px 16px 0 16px; font-size: 12px; color: #49454F;
            min-height: 1.2em; transition: color 0.2s;
        }
        .textfield-root-container.shared-textfield-1 .textfield-helper-text:empty {
             display: none; 
        }

        /* --- FOCUSED STATE (Scoped) --- */
        .textfield-root-container.shared-textfield-1 .textfield-input:focus {
            border-top: none;
            border-left: none;
            border-right: none;
            border-bottom:1px solid #FF94DA;
        }
        .textfield-root-container.shared-textfield-1 .textfield-input:focus ~ .textfield-label {
            transform: translateY(-190%) scale(0.75);
            color: #7D5260;
            display: none;
        }
        .textfield-root-container.shared-textfield-1:focus-within .textfield-outline {
            height: 2.0px;
            background-color: #7D5260;
        }
        
        /* --- ERROR STATE (Scoped) --- */
        .textfield-root-container.shared-textfield-1.error .textfield-label,
        .textfield-root-container.shared-textfield-1.error:focus-within .textfield-label {
            color: #B3261E;
        }
        .textfield-root-container.shared-textfield-1.error .textfield-outline {
            height: 2.0px;
            background-color: #B3261E;
        }
        .textfield-root-container.shared-textfield-1.error .textfield-helper-text {
            color: #B3261E;
        }

        /* --- DISABLED STATE (Scoped) --- */
        .textfield-root-container.shared-textfield-1.disabled .textfield-input {
            background-color: rgba(0, 0, 0, 0.06);
            color: rgba(0, 0, 0, 0.38);
        }
        .textfield-root-container.shared-textfield-1.disabled .textfield-label,
        .textfield-root-container.shared-textfield-1.disabled .textfield-helper-text {
            color: rgba(0, 0, 0, 0.38);
        }
        .textfield-root-container.shared-textfield-1.disabled .textfield-outline {
            background-color: rgba(0, 0, 0, 0.12);
        }
        
.shared-elevatedbutton-0 { display: inline-flex; align-items: center; justify-content: center; padding: 8px 16px; margin: 4px; border: none; border-radius: 20px; background-color: blue; color: white; cursor: pointer; text-align: center; text-decoration: none; outline: none; box-sizing: border-box; overflow: hidden; position: relative; transition: box-shadow 0.28s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.15s linear; -webkit-appearance: none; -moz-appearance: none; appearance: none; box-shadow: 0px 1.0px 2.0px 0px rgba(0,0,0,0.15), 0px 2.0px 4.0px 1px rgba(0,0,0,0.10); }
.shared-elevatedbutton-0:hover { box-shadow: 0px 1.5px 3.0px 0px rgba(0,0,0,0.18), 0px 3.0px 6.0px 1px rgba(0,0,0,0.13); /* Add background overlay? */ }
.shared-elevatedbutton-0:active { box-shadow: none; /* Add background overlay? */ }
.shared-elevatedbutton-0.disabled { background-color: rgba(0, 0, 0, 0.12); color: rgba(0, 0, 0, 0.38); box-shadow: none; cursor: default; pointer-events: none; }


            .shared-text-1 {
                margin: 0; /* Reset default paragraph margin */
                padding: 0;
                
                
                
            }
            

        .shared-slider-0.slider-container {
            position: relative; width: 100%; height: 20px;
            display: flex; align-items: center; cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }
        .shared-slider-0 .slider-track, .shared-slider-0 .slider-track-active {
            position: absolute; width: 100%; height: 4px;
            border-radius: 2px; pointer-events: none;
        }
        .shared-slider-0 .slider-track { background-color: #E7E0EC; }
        .shared-slider-0 .slider-track-active {
            background-color: green; width: var(--slider-percentage, 0%);
        }
        .shared-slider-0 .slider-thumb {
            position: absolute; left: var(--slider-percentage, 0%);
            transform: translateX(-50%); width: 14px; height: 14px;
            background-color: white; border-radius: 50%;
            border: 2px solid white;
            transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2); pointer-events: none;
        }
        .shared-slider-0.slider-container:hover .slider-thumb { transform: translateX(-50%) scale(1.2); }
        .shared-slider-0.slider-container.active .slider-thumb {
            transform: translateX(-50%) scale(1.4);
            box-shadow: 0 0 0 8px rgba(103, 80, 164, 0.15);
        }
        </style>
    
        <script src="qwebchannel.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                new QWebChannel(qt.webChannelTransport, (channel) => {
                    window.pywebview = channel.objects.pywebview;
                    console.log("PyWebChannel connected.");
                });
            });
            function handleClick(name) { if(window.pywebview) window.pywebview.on_pressed_str(name, ()=>{}); }
            function handleItemTap(name, index) { if(window.pywebview) window.pywebview.on_item_tap(name, index, ()=>{}); }
            function handleInput(name, value) {
                if(window.pywebview) {
                    window.pywebview.on_input_changed(name, value, ()=>{});
                }
            }
        </script>
        <script>
        function PythraSlider(elementId, options) {
    // The 'this' keyword refers to the new object being created.
    this.container = document.getElementById(elementId);
    if (!this.container) {
        console.error(`Slider container with ID #${elementId} not found.`);
        return;
    }

    console.log(`✅ PythraSlider engine is initializing for #${elementId}`);

    this.options = options;

    // Find child elements
    this.track = this.container.querySelector('.slider-track');
    this.thumb = this.container.querySelector('.slider-thumb');
    
    // Bind 'this' context for event handlers
    this.handleDragStart = this.handleDragStart.bind(this);
    this.handleDragMove = this.handleDragMove.bind(this);
    this.handleDragEnd = this.handleDragEnd.bind(this);

    // Attach initial event listeners
    this.container.addEventListener('mousedown', this.handleDragStart);
    this.container.addEventListener('touchstart', this.handleDragStart, { passive: false }); // passive: false to allow preventDefault
}

PythraSlider.prototype.handleDragStart = function(event) {
    event.preventDefault();
    this.container.classList.add('active');
    
    document.addEventListener('mousemove', this.handleDragMove);
    document.addEventListener('mouseup', this.handleDragEnd);
    document.addEventListener('touchmove', this.handleDragMove);
    document.addEventListener('touchend', this.handleDragEnd);

    this.updatePosition(event);
};

PythraSlider.prototype.handleDragMove = function(event) {
    this.updatePosition(event);
};

PythraSlider.prototype.handleDragEnd = function() {
    this.container.classList.remove('active');
    
    document.removeEventListener('mousemove', this.handleDragMove);
    document.removeEventListener('mouseup', this.handleDragEnd);
    document.removeEventListener('touchmove', this.handleDragMove);
    document.removeEventListener('touchend', this.handleDragEnd);
};

PythraSlider.prototype.updatePosition = function(event) {
    if (!this.track) return;
    const rect = this.track.getBoundingClientRect();
    const clientX = event.touches ? event.touches[0].clientX : event.clientX;
    
    let positionX = clientX - rect.left;
    let percentage = (positionX / rect.width) * 100;
    
    percentage = Math.max(0, Math.min(100, percentage));
    
    this.container.style.setProperty('--slider-percentage', `${percentage}%`);
    
    const range = this.options.max - this.options.min;
    const newValue = this.options.min + (percentage / 100) * range;
    
    if (window.pywebview && this.options.onChangedName) {
        window.pywebview.on_drag_update(this.options.onChangedName, newValue);
    }
};

PythraSlider.prototype.destroy = function() {
    if (!this.container) return;
    this.container.removeEventListener('mousedown', this.handleDragStart);
    this.container.removeEventListener('touchstart', this.handleDragStart);
    this.handleDragEnd(); 
};
        </script>
        
</head>
<body>
    <div id="root-container"><div id="fw_id_1" class="shared-container-0" style="display: block"><div id="fw_id_2" class="shared-column-0"><p id="fw_id_3" class="shared-text-0" style="font-size: 24; font-weight: bold">Login Form</p><div id="fw_id_4" class="" style="height: 24px"></div>
        <div id="fw_id_5" class="textfield-root-container shared-textfield-0">
            <div class="textfield-container shared-textfield-0">
                <input 
                    id="fw_id_5_input" 
                    class="textfield-input shared-textfield-0" 
                    type="text" 
                    value="initial text"
                    placeholder="None"
                    oninput="handleInput('ctrl_2252542296816', this.value)"
                    
                >
                <label for="fw_id_5_input" class="textfield-label shared-textfield-0">Username</label>
                <div class="textfield-outline shared-textfield-0"></div>
            </div>
            <div id="fw_id_5_helper" class="textfield-helper-text shared-textfield-0"></div>
        </div>
        <div id="fw_id_6" class="" style="height: 16px"></div>
        <div id="fw_id_7" class="textfield-root-container shared-textfield-1">
            <div class="textfield-container shared-textfield-1">
                <input 
                    id="fw_id_7_input" 
                    class="textfield-input shared-textfield-1" 
                    type="password" 
                    value=""
                    placeholder="None"
                    oninput="handleInput('ctrl_2252522277136', this.value)"
                    
                >
                <label for="fw_id_7_input" class="textfield-label shared-textfield-1">Password</label>
                <div class="textfield-outline shared-textfield-1"></div>
            </div>
            <div id="fw_id_7_helper" class="textfield-helper-text shared-textfield-1"></div>
        </div>
        <div id="fw_id_8" class="" style="height: 24px"></div><button id="fw_id_9" class="shared-elevatedbutton-0" onclick="handleClick('attempt_login')"><p id="fw_id_10" class="shared-text-1">Login</p></button><div id="fw_id_11" class="" style="height: 24px"></div><p id="fw_id_12" class="shared-text-1">initial text</p><div id="fw_id_13" class="" style="height: 24px"></div><div id="fw_id_14" class=""><div id="fw_id_15" class="shared-column-0"><p id="fw_id_16" class="shared-text-1">Current Value: 0.5</p>
        <div id="fw_id_17" class="slider-container shared-slider-0" style="width: 100%; --slider-percentage: 50.0%;">
            <div class="slider-track"></div>
            <div class="slider-track-active"></div>
            <div class="slider-thumb"></div>
        </div>
        <div id="fw_id_18" class="" style="height: 24px"></div><button id="fw_id_19" class="shared-elevatedbutton-0" onclick="handleClick('move_slider')"><p id="fw_id_20" class="shared-text-1">Move</p></button><div id="fw_id_21" class="" style="height: 24px"></div></div></div></div></div></div>
    <div id="overlay-container"></div>

    <!-- ADD SIMPLEBAR JS -->
    <script src="./js/virtualList.js"></script>
    <script src="./js/scroll-bar/simplebar.min.js"></script>
    <!-- ADD THE NEW SLIDER JS ENGINE -->
    
        <script type="module">
            // Import JS modules if needed (e.g., for ClipPath)
            // import { ... } from './js/....js';
            // import { generateRoundedPath } from './js/pathGenerator.js';
            // import { ResponsiveClipPath } from './js/clipPathUtils.js';
            import { PythraSlider } from './js/slider.js';
            

            document.addEventListener('DOMContentLoaded', () => {
                window._pythra_instances = window._pythra_instances || {};
                try {
                     // First, DEFINE all our JS classes and functions
                    // js/pathGenerator.js

// --- Vector Math Helper Functions ---
const vec = (p1, p2) => ({ x: p2.x - p1.x, y: p2.y - p1.y });
const magnitude = (v) => Math.sqrt(v.x ** 2 + v.y ** 2);
const dot = (v1, v2) => v1.x * v2.x + v1.y * v2.y;
const cross = (v1, v2) => v1.x * v2.y - v1.y * v2.x;
const round = (val) => Math.round(val * 100) / 100; // Round to 2 decimal places

function generateRoundedPath(points, radius) {
    const numPoints = points.length;
    const cornerData = [];

    console.log(`>>>>>> Generator Initiated <<<<<<`)

    for (let i = 0; i < numPoints; i++) {
        const p_prev = points[(i + numPoints - 1) % numPoints];
        const p_curr = points[i];
        const p_next = points[(i + 1) % numPoints];

        const v1 = vec(p_curr, p_prev);
        const v2 = vec(p_curr, p_next);
        const v1_mag = magnitude(v1);
        const v2_mag = magnitude(v2);

        if (v1_mag === 0 || v2_mag === 0) {
            cornerData.push({ t1: p_curr, t2: p_curr, radius: 0 });
            continue;
        }

        const angle = Math.acos(Math.max(-1, Math.min(1, dot(v1, v2) / (v1_mag * v2_mag))));
        let tangentDist = radius / Math.tan(angle / 2);
        tangentDist = Math.min(tangentDist, v1_mag / 2, v2_mag / 2);
        const clampedRadius = Math.abs(tangentDist * Math.tan(angle / 2));

        const t1 = { x: p_curr.x + (v1.x / v1_mag) * tangentDist, y: p_curr.y + (v1.y / v1_mag) * tangentDist };
        const t2 = { x: p_curr.x + (v2.x / v2_mag) * tangentDist, y: p_curr.y + (v2.y / v2_mag) * tangentDist };

        const sweepFlag = cross(v1, v2) < 0 ? 1 : 0;

        cornerData.push({ t1, t2, radius: clampedRadius, sweepFlag });
    }

    const pathCommands = [];
    pathCommands.push(`M ${round(cornerData[numPoints - 1].t2.x)} ${round(cornerData[numPoints - 1].t2.y)}`);
    for (let i = 0; i < numPoints; i++) {
        const corner = cornerData[i];
        pathCommands.push(`L ${round(corner.t1.x)} ${round(corner.t1.y)}`);
        pathCommands.push(`A ${round(corner.radius)} ${round(corner.radius)} 0 0 ${corner.sweepFlag} ${round(corner.t2.x)} ${round(corner.t2.y)}`);
    }
    pathCommands.push('Z');
    console.log(pathCommands.join(' '));
    return pathCommands.join(' ');
}

// clipPathUtils.js

/**
 * Parse an SVG path string containing absolute commands (M, L, A, H, V, Z),
 * and scale coordinates from reference dimensions to target dimensions.
 * 
 * @param {string} pathStr - Original SVG path string (absolute commands only)
 * @param {number} refW - reference width
 * @param {number} refH - reference height
 * @param {number} targetW - actual element width
 * @param {number} targetH - actual element height
 * @param {Object} [options] - optional settings:
 *    - {boolean} uniformArc
 *    - {number} decimalPlaces
 *    - {boolean} percentOutput
 * @returns {string} - scaled path string
 */
// clipPathUtils.js

function scalePathAbsoluteMLA(pathStr, refW, refH, targetW, targetH, options = {}) {
  const rw = targetW / refW;
  const rh = targetH / refH;
  const uniformArc = !!options.uniformArc;
  const decimalPlaces = typeof options.decimalPlaces === 'number' ? options.decimalPlaces : null;
  const rScale = uniformArc ? Math.min(rw, rh) : null;

  const fmt = (num) => {
    return decimalPlaces !== null
      ? Number(num.toFixed(decimalPlaces)).toString()
      : Number(num).toString();
  };

  // Normalize the string
  const s = pathStr
    .replace(/,/g, ' ')
    .replace(/([0-9])-/g, '$1 -')
    .replace(/\s+/g, ' ')
    .trim();

  const tokenRegex = /([MLAZHV])|(-?\d*\.?\d+(?:e[-+]?\d+)?)/gi;
  const tokens = [];
  let match;
  while ((match = tokenRegex.exec(s)) !== null) {
    tokens.push(match[1] || match[2]);
  }

  const out = [];
  let i = 0;
  while (i < tokens.length) {
    const cmd = tokens[i++];
    out.push(cmd);

    switch (cmd) {
      case 'M':
      case 'L':
        while (i + 1 < tokens.length && !/^[MLAZHV]$/.test(tokens[i])) {
          const x = parseFloat(tokens[i++]) * rw;
          const y = parseFloat(tokens[i++]) * rh;
          out.push(fmt(x), fmt(y));
        }
        break;

      case 'A':
        while (i + 6 < tokens.length && !/^[MLAZHV]$/.test(tokens[i])) {
          const rx = parseFloat(tokens[i++]);
          const ry = parseFloat(tokens[i++]);
          const rot = tokens[i++];
          const laf = tokens[i++];
          const sf = tokens[i++];
          const x = parseFloat(tokens[i++]);
          const y = parseFloat(tokens[i++]);

          out.push(
            fmt(uniformArc ? rx * rScale : rx * rw),
            fmt(uniformArc ? ry * rScale : ry * rh),
            rot,
            laf,
            sf,
            fmt(x * rw),
            fmt(y * rh)
          );
        }
        break;

      case 'H':
        while (i < tokens.length && !/^[MLAZHV]$/.test(tokens[i])) {
          const x = parseFloat(tokens[i++]) * rw;
          out.push(fmt(x));
        }
        break;

      case 'V':
        while (i < tokens.length && !/^[MLAZHV]$/.test(tokens[i])) {
          const y = parseFloat(tokens[i++]) * rh;
          out.push(fmt(y));
        }
        break;

      case 'Z':
        // No coordinates to scale
        break;

      default:
        console.warn('Unsupported or unexpected token:', cmd);
    }
  }

  return out.join(' ');
}

class ResponsiveClipPath {
  constructor(target, originalPath, refW, refH, options = {}) {
    this.elements = [];
    this.orig = originalPath.trim();
    this.refW = refW;
    this.refH = refH;
    this.options = options;
    this.currentPath = "";  // ⬅️ Store last computed path string
    this.update = this.update.bind(this);
    this.roList = [];

    if (typeof target === 'string') {
      let selector = target;
      if (!selector.startsWith('#') && !selector.startsWith('.')) {
        const byId = document.getElementById(selector);
        selector = byId ? `#${selector}` : `.${selector}`;
      }
      const nodeList = document.querySelectorAll(selector);
      if (nodeList.length === 0) {
        console.warn(`ResponsiveClipPath: no elements found for selector "${selector}"`);
      }
      nodeList.forEach(el => this.elements.push(el));
    } else if (target instanceof HTMLElement) {
      this.elements.push(target);
    } else {
      console.warn('ResponsiveClipPath: invalid target', target);
    }

    this.elements.forEach(el => this.initElement(el));
  }

  initElement(el) {
    this.applyClip(el);
    if (window.ResizeObserver) {
      const ro = new ResizeObserver(() => this.applyClip(el));
      ro.observe(el);
      this.roList.push({ el, ro });
    } else {
      window.addEventListener('resize', this.update);
    }
  }

  applyClip(el) {
    const rect = el.getBoundingClientRect();
    const newPath = scalePathAbsoluteMLA(
      this.orig,
      this.refW,
      this.refH,
      rect.width,
      rect.height,
      this.options
    );
    this.currentPath = `path("${newPath}")`;  // ⬅️ Save it
    el.style.clipPath = this.currentPath;
    el.style.webkitClipPath = this.currentPath;
  }

  update() {
    this.elements.forEach(el => this.applyClip(el));
  }

  disconnect() {
    this.roList.forEach(({ el, ro }) => ro.unobserve(el));
    this.roList = [];
    window.removeEventListener('resize', this.update);
  }

  // ✅ Your new method
  getResponsivePath() {
    return this.currentPath;
  }
}

/**
 * PythraSlider: A client-side engine for handling slider interactions.
 * This is now a proper JavaScript module class.
 */
class PythraSlider { // <-- ADD 'export' HERE
    constructor(elementId, options) {
        this.container = document.getElementById(elementId);
        if (!this.container) {
            console.error(`Slider container with ID #${elementId} not found.`);
            return;
        }

        console.log(`✅ PythraSlider engine is initializing for #${elementId}`);

        this.options = options;
        
        // ... THE REST OF THE FILE REMAINS EXACTLY THE SAME ...
        this.track = this.container.querySelector('.slider-track');
        this.thumb = this.container.querySelector('.slider-thumb');
        
        this.handleDragStart = this.handleDragStart.bind(this);
        this.handleDragMove = this.handleDragMove.bind(this);
        this.handleDragEnd = this.handleDragEnd.bind(this);

        this.container.addEventListener('mousedown', this.handleDragStart);
        this.container.addEventListener('touchstart', this.handleDragStart, { passive: false });
    }

    handleDragStart(event) {
        event.preventDefault();
        this.container.classList.add('active');
        
        document.addEventListener('mousemove', this.handleDragMove);
        document.addEventListener('mouseup', this.handleDragEnd);
        document.addEventListener('touchmove', this.handleDragMove);
        document.addEventListener('touchend', this.handleDragEnd);

        this.updatePosition(event);
    }

    handleDragMove(event) {
        this.updatePosition(event);
    }

    handleDragEnd() {
        this.container.classList.remove('active');
        
        document.removeEventListener('mousemove', this.handleDragMove);
        document.removeEventListener('mouseup', this.handleDragEnd);
        document.removeEventListener('touchmove', this.handleDragMove);
        document.removeEventListener('touchend', this.handleDragEnd);
    }

    updatePosition(event) {
        if (!this.track) return;
        const rect = this.track.getBoundingClientRect();
        const clientX = event.touches ? event.touches[0].clientX : event.clientX;
        
        let positionX = clientX - rect.left;
        let percentage = (positionX / rect.width) * 100;
        
        percentage = Math.max(0, Math.min(100, percentage));
        
        this.container.style.setProperty('--slider-percentage', `${percentage}%`);
        console.log(percentage, this.options.onDragName);
        
        const range = this.options.max - this.options.min;
        const newValue = this.options.min + (percentage / 100) * range;
        console.log(percentage, this.options.onDragName, newValue);
        
        if (window.pywebview && this.options.onDragName) {
            window.pywebview.on_drag_update(this.options.onDragName, newValue);
        }
    }

    destroy() {
        if (!this.container) return;
        this.container.removeEventListener('mousedown', this.handleDragStart);
        this.container.removeEventListener('touchstart', this.handleDragStart);
        this.handleDragEnd(); 
    }
}

                    // Then, RUN the initialization commands
                    
                    if (typeof PythraSlider !== 'undefined') {
                        // Make sure we don't re-initialize if it somehow already exists
                        if (!window._pythra_instances['fw_id_17']) {
                            console.log('Initializing PythraSlider for #fw_id_17');
                            window._pythra_instances['fw_id_17'] = new PythraSlider('fw_id_17', {"min": 0.0, "max": 1.0, "onDragName": "slider_update_2252542296480"});
                        }
                    } else {
                        console.error('PythraSlider class not found. Make sure slider.js is included.');
                    }
                
                } catch (e) {
                    console.error("Error running Pythra initializers:", e);
                }
            });
        </script>
        
</body>
</html>